# Body Interface

2023年4月から取り組んでいるプロジェクトです。
"全身デバイス"を実現するため段階的に様々な機能を試していきます。

各章のタイトル下にリポジトリのリンクが張ってあります。
## 1.手でスライド送り
[ソースコード(Motion-Keyboard)]()

初めに作成しようとしたのが、"指パッチンでスライドを送る"デバイスです。<br>指っパッチンをトリガーにするため、勢いでボタン押下、*パッチン*の音、などを考えましたが、指パッチンのメカニズムを調べてみると、指先や手の腹にモノを入れてしまうとうまく音が出ないとのことでした。よってパッチンではなく、ジェスチャーをトリガーにしようと考えました。<br>ジェスチャーでやるにしても、手段はいくつかあります。まず思いつくのは「モーキャプ」でしょう。しかし私が目指す（好きな）のはウェアラブル。<br>よってとりあえず「**加速度センサ**」を使うことにしました。<br>では次、いかにしてスライドを送りましょう。単純ですが、思いつくのは「キーボード」でした。調べてみると、[ESP32 BLE keyboard.h]なるライブラリがあるではありませんか。<br>よって使うマイコンはESP32です。<br>**ESP32でIMUを使いウェアラブルにしたい。**<br>このすべてを解決してくれるものがありました。(持っていた)<br>**M5Stick C Plus**です。<br>そこで数日掛けカタカタ打ちまくった結果.....<br><br>できました。<br><br>![](images/prototype.JPG)<br>
少し見栄えは悪いですが、初号機、プロトタイプとしては十分でしょう。<br>
> - 機能<br>
>
> ボタンを押している間に手を振ると ←/→ のキーコードを送信する。

で、これにショートカットキーなどいろいろ追加してUIとかもいろいろやったのがこれ
![](images/ver1.1.JPG)
> - 機能<br>
> 
> 4つのモードを設定 (Presentation,Browsing,Media,Selectable)
> 各モードでそれぞれ扱うキーやショートカットが異なる
> Selectableモードでは (プリセットの中から使えるキーを選択可能)

||Presentation|Browsing|Media|Selectable|
|:---:|---|---|---|---|
|ボタン1 + 振り|方向キー←/→|方向キー↑/↓|トラック送り/戻し|方向キー←/→|
|ボタン2 + 振り|ウィンドウ遷移|ブラウザ進む/戻る|音量大/小|ブラウザ進む/戻る|
|ボタン1 + ボタン2|再生/停止|F5キー|再生/停止|Selectable|

[動画]()
## 2.手でマウス操作
[ソースコード(Motion-Mouse)]()

BLE keyboard.h なるライブラリの作者が BLE mouse.h なるライブラリをも作っていたので次はマウス。(もう一つ有能ライブラリあります。後に続く)<br>1で作った方は、ジェスチャーなのでなんとなくで動き判定を行っていましたが、さすがにマウスとなると、x軸方向y軸方向のカーソル移動を分ける必要があるのでもう少し厳密に加速度センサを扱わなければなりませんね。
そこで観察してみました。<br>![](images/imuwatching.JPG)

航空学科じゃないので詳しくなかったのですが、色々調べながらやったところ<br>

$$
Acc_n は n軸の重力加速度とする。\\
roll = \tan^{-1}{\frac{Acc_x}{\sqrt{Acc_y^2+Acc_z^2}}}\\\\
pitch = \tan^{-1}{\frac{Acc_y}{\sqrt{Acc_x^2+Acc_z^2}}}\\\\
yaw = \tan^{-1}{\frac{\sqrt{Acc_x^2+Acc_y^2}}{Acc_z}}\\\\
$$

<br>
という数式によって得られるそうでこいつらの値と、軸速度gyro_nもとってくると...
<br>

||水平で固定|右ひねりで固定|
|---:|---:|---:|
|`gyroX`|||
|`gyroY`|||
|`gyroZ`|||
|roll|||
|pitch|||
|yaw|||

<br><br><br>と分かった。これらを組み込んでやったのが......


<br><br><br><br>こちら。
![](images/)

> - 機能
> 
> マウスの基本機能(カーソル移動、右左中央クリック、ドラッグ、スクロール)が全てできる。

||ボタン1+振り|ボタン2|ボタン1+2+振り|
|---|---|---|---|
|水平|カーソル移動|左クリック|ドラッグ|
|右ひねり|スクロール|右クリック|中央ボタン+移動|

<br>

[動画](https://twitter.com/shiwasu_tech/status/1656628823746809857?s=20)

